!function(a){a.richFilemanagerPlugin=function(b,c){function d(a){return y.indexOf(a)>-1}function e(b,c){if(!d(c))return!1;if("select"===c&&"folder"===b.type)return!1;if("extract"===c){var e=fa(b.attributes.name);return"file"===b.type&&"zip"===e}return"download"===c&&"folder"===b.type?v.options.allowFolderDownload===!0:"undefined"==typeof b.attributes.capabilities||a.inArray(c,b.attributes.capabilities)>-1}function f(){v.filetree.enabled&&(r.show(),o.splitter({sizeLeft:v.filetree.width,minLeft:v.filetree.minWidth,minRight:200}))}function g(){return window.opener||window.parent&&window.self!==window.parent||window.tinyMCEPopup||F.param("field_name")||F.param("CKEditor")||F.param("ImperaviElementId")}function h(a){return a.attributes.readable?("file"===a.type&&Da(a),void("folder"!==a.type&&"parent"!==a.type||(B.previewFile(!1),location.hash=a.id))):(j.error(P("NOT_ALLOWED_SYSTEM")),!1)}var i={baseUrl:".",configUrl:null,config:{},callbacks:{beforeCreateImageUrl:function(a,b){return b},beforeCreatePreviewUrl:function(a,b){return b},beforeSelectItem:function(a,b){return b},afterSelectItem:function(a,b,c){},beforeSetRequestParams:function(a,b){return b},beforeSendRequest:function(a,b){return!0}}},j=this,k=a(b),l=k.children(".fm-wrapper"),m=l.find(".fm-header"),n=m.find(".fm-uploader"),o=l.children(".fm-splitter"),p=l.children(".fm-footer"),q=o.children(".fm-fileinfo"),r=o.children(".fm-filetree"),s=q.find(".view-items-wrapper"),t=q.find(".fm-preview-wrapper"),u=s.find(".view-items"),v=(n.children(".fm-upload"),null),w="/",x=null,y=[],z=null,A=null,B=null,C=null,D=null,E=null,F=purl();(new Date).getTime();j.settings=a.extend(!0,i,c),j.write=function(b,c){var d=alertify,e=a.extend({},{reset:!0,delay:5e3,logMaxItems:5,logPosition:"bottom right",logContainerClass:"fm-log",logMessageTemplate:null,parent:document.body,onClick:void 0,unique:!1,type:"log"},c);if(e.logClass&&e.unique&&a(".fm-log").children("."+e.logClass).length>0)return d;e.reset&&d.reset(),d.parent(e.parent),d.logDelay(e.delay),d.logMaxItems(e.logMaxItems),d.logPosition(e.logPosition),d.logContainerClass(e.logContainerClass),d.logMessageTemplate(e.logMessageTemplate),d[e.type](b,e.onClick);var f=d.getLogs();return f[f.length-1]},j.error=function(b,c){return j.write(b,a.extend({},{type:"error",delay:1e4},c))},j.warning=function(b,c){return j.write(b,a.extend({},{type:"warning",delay:1e4},c))},j.success=function(b,c){return j.write(b,a.extend({},{type:"success",delay:6e3},c))},j.alert=function(a){alertify.reset().dialogContainerClass("fm-popup").alert(a)},j.confirm=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").confirm(a.message,a.okBtn,a.cancelBtn)},j.prompt=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").theme(a.template).prompt(a.message,a.value||"",a.okBtn,a.cancelBtn)},j.dialog=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").dialog(a.message,a.buttons)},j.setDimensions=function(){var b=l.outerHeight(!0)-l.height(),c=a(window).height()-m.height()-p.height()-b,d=o.width()-o.children(".splitter-bar-vertical").outerWidth()-r.outerWidth();o.height(c),q.width(d)},j.console=function(){v.options.logger&&arguments&&[].unshift.call(arguments,(new Date).getTime())},j.refreshFolder=function(){B.loadPath(B.currentPath())},j.loadFolder=function(a){"/"!==a&&(a="/"+_(a,"/")+"/"),B.loadPath(a)};var G=function(){var b=a.Deferred();b.then(function(){return H()}).then(function(){return J()}).then(function(a,b){return I()}).then(function(){K(function(){L()})}),b.resolve()},H=function(){return a.when(S("default"),S("user")).done(function(b,c){var d=b[0],e=c[0];if(void 0!==e&&null!==e&&delete e.version,v=a.extend({},d,e),v.api.connectorUrl)x=v.api.connectorUrl;else{var f=location.origin+location.pathname,g="connectors/"+v.api.lang+"/filemanager."+v.api.lang;fa(f).length>0&&(f=f.substring(0,f.lastIndexOf("/")+1)),x=f+g}})},I=function(){return oa("GET",{mode:"initiate"}).done(function(b){if(b.data){var c=b.data.attributes.config;a.each(c,function(b,c){a.each(c,function(a,c){return null===c||(void 0===v[b]&&(v[b]=[]),void(v[b][a]=c))})}),c.options&&c.options.capabilities&&(v.options.capabilities=c.options.capabilities)}}).fail(function(a){j.error("Unable to perform initial request to server."),Y(a)}).then(function(b){if(b.errors)return a.Deferred().reject()})},J=function(){return C=new M,a.ajax().then(function(){var a=F.param("langCode");return a?R(C.buildLangFileUrl(a)).done(function(){C.setLang(a)}).fail(function(){setTimeout(function(){j.error("Given language file ("+C.buildLangFileUrl(a)+") does not exist!")},500)}):void C.setLang(v.language["default"])}).then(function(){var b=C.buildLangFileUrl(C.getLang())+"?_="+(new Date).getTime();return a.ajax({type:"GET",url:b,dataType:"json"}).done(function(a){C.setTranslations(a)})})},K=function(a){var b=[],c=[];v.customScrollbar.enabled&&(b.push("/libs/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),b.push("/libs/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js")),b.push(a),T(b),c.length&&T(c)},L=function(){D=new N,y=v.options.capabilities||["upload","select","download","rename","copy","move","delete","extract","createFolder"],v.security.readOnly&&(v.options.browseOnly=!0),v.upload.paramName||(v.upload.paramName="files");var b=[];v.options.fileSorting&&(b=v.options.fileSorting.toLowerCase().split("_")),z=b[0]||"name",A=b[1]||"asc";var c=F.param("exclusiveFolder");c&&(w="/"+c+"/",w=ea(w));var d=j.settings.expandedFolder;if(d&&(E=w+d+"/",E=ea(E)),B=new O,ko.applyBindings(B),B.itemsModel.initiateLazyLoad(),B.filterModel.setName(F.param("filter")),ko.bindingHandlers.toggleNodeVisibility={init:function(b,c){var d=c();a(b).toggle(d.isExpanded())},update:function(b,c){var d=c();return d.isSliding()!==!1&&(d.isExpanded()===!1&&a(b).slideDown(v.filetree.expandSpeed,function(){d.isSliding(!1),d.isExpanded(!0)}),void(d.isExpanded()===!0&&a(b).slideUp(v.filetree.expandSpeed,function(){d.isSliding(!1),d.isExpanded(!1)})))}},ko.bindingHandlers.draggableView={init:function(a,b,c){B.ddModel.makeDraggable(b(),a)}},ko.bindingHandlers.droppableView={init:function(a,b,c){B.ddModel.makeDroppable(b(),a)}},ko.bindingHandlers.draggableTree={init:function(a,b,c){B.ddModel.makeDraggable(b(),a)}},ko.bindingHandlers.droppableTree={init:function(a,b,c){B.ddModel.makeDroppable(b(),a)}},l.mousewheel(function(b){if(!B.ddModel.dragHelper)return!0;var c,d=null;if(c=v.customScrollbar.enabled?a([s[0],r[0]]):o.children(".splitter-pane"),c.each(function(c){var e=a(this),f=e.offset().top,g=e.offset().left;if(b.offsetY>=f&&b.offsetY<=f+e.height()&&b.offsetX>=g&&b.offsetX<=g+e.width())return d=e,!1}),null===d)return!1;if(v.customScrollbar.enabled){var e=d.find(".mCSB_scrollTools_vertical"),f=1===b.deltaY?"+":"-";e.is(":visible")&&d.mCustomScrollbar("scrollTo",[f+"=250",0],{scrollInertia:500,scrollEasing:"easeOut",callbacks:!0})}else if(d[0].scrollHeight>d[0].clientHeight){var g=d.scrollTop(),h=g-200*b.deltaY;B.ddModel.isScrolling=!0,h=h<0?0:h,d.stop().animate({scrollTop:h},100,"linear",function(){B.ddModel.isScrolling=!1,B.ddModel.isScrolled=!0})}}),u.selectable({filter:"li:not(.directory-parent), tbody > tr:not(.directory-parent)",cancel:".directory-parent, thead",disabled:!v.manager.selection.enabled,appendTo:u,start:function(a,b){va(),B.itemsModel.isSelecting(!0)},stop:function(a,b){B.itemsModel.isSelecting(!1)},selected:function(a,b){var c=ko.dataFor(b.selected);c.selected(!0)},unselected:function(a,b){var c=ko.dataFor(b.unselected);c.selected(!1)}}),v.extras.extra_js)for(var e=0;e<v.extras.extra_js.length;e++)a.ajax({type:"GET",url:v.extras.extra_js[e],dataType:"script",async:v.extras.extra_js_async});F.param("CKEditorCleanUpFuncNum")&&(B.headerModel.closeButton(!0),B.headerModel.closeButtonOnClick=function(){parent.CKEDITOR.tools.callFunction(F.param("CKEditorCleanUpFuncNum"))}),f(),B.treeModel.loadDataNode(B.treeModel.rootNode,!0,!0),v.customScrollbar.enabled&&(r.mCustomScrollbar({theme:v.customScrollbar.theme,scrollButtons:{enable:v.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onScrollStart:function(){B.ddModel.isScrolling=!0},onScroll:function(){B.ddModel.isScrolling=!1}},axis:"yx"}),t.mCustomScrollbar({theme:v.customScrollbar.theme,scrollButtons:{enable:v.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".fm-preview-viewer"}}),s.mCustomScrollbar({theme:v.customScrollbar.theme,scrollButtons:{enable:v.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".grid, .list"},callbacks:{onScrollStart:function(){B.itemsModel.continiousSelection()||(this.yStartPosition=this.mcs.top,this.yStartTime=(new Date).getTime()),B.ddModel.isScrolling=!0},onScroll:function(){B.ddModel.isScrolling=!1,B.ddModel.isScrolled=!0},whileScrolling:function(){if(v.manager.selection.enabled){var a=(new Date).getTime()-this.yStartTime;!B.itemsModel.continiousSelection()&&a>400&&(this.yStartPosition=this.mcs.top),B.itemsModel.isSelecting()&&B.itemsModel.continiousSelection(!0);var b=Math.abs(this.mcs.top)-Math.abs(this.yStartPosition);u.selectable("repositionCssHelper",b,0)}B.itemsModel.lazyLoad&&B.itemsModel.lazyLoad.handleScroll()}},axis:"y",alwaysShowScrollbar:0}));var g=document.documentElement;if(g.setAttribute("data-useragent",navigator.userAgent),v.options.logger){(new Date).getTime()}var h=k.find(".fm-loading-wrap");h.fadeOut(800,function(){j.setDimensions()}),j.setDimensions()},M=function(){var a=null,b={},c=j.settings.baseUrl+"/languages/";this.buildLangFileUrl=function(a){return c+a+".json"},this.setLang=function(b){a=b},this.getLang=function(){return a},this.setTranslations=function(a){b=a},this.getTranslations=function(){return b},this.translate=function(a){return b[a]}},N=function(){var a={},b=this;this.push=function(c,d,e){b.removeTimer(c),a[c]=setTimeout(d,e)},this.getTimer=function(b){return a[b]},this.removeTimer=function(b){a[b]&&(clearTimeout(a[b]),delete a[b])}},O=function(){function b(a){return(!v.manager.selection.enabled||!v.manager.selection.useCtrlKey||a.ctrlKey!==!0)&&(!v.manager.dblClickOpen||"click"!==a.type)}var c=this;this.config=ko.observable(v),this.loadingView=ko.observable(!0),this.previewFile=ko.observable(!1),this.viewMode=ko.observable(v.manager.defaultViewMode),this.currentPath=ko.observable(w),this.browseOnly=ko.observable(v.options.browseOnly),this.previewModel=ko.observable(null),this.currentLang=C.getLang(),this.lg=C.getTranslations(),this.previewFile.subscribe(function(a){a||(c.previewModel.closeEditor(),c.itemsModel.descriptivePanel.rdo().id===c.previewModel.rdo().id&&c.itemsModel.descriptivePanel.render(c.previewModel.viewer.content()))}),this.isCapable=function(a){return d(a)},this.loadPath=function(a){var b=new r(a);b.setPreloader(c.itemsModel.getPreloader()).setDataHandler(function(a,b){c.itemsModel.addItems(a,b,!0),c.searchModel.clearInput()}).load(function(){return Ga(a)})},this.addElements=function(a,b,d){var e=c.treeModel.findByParam("id",b);e&&c.treeModel.addNodes(a,e,d),c.currentPath()===b&&c.itemsModel.addItems(a,b,d)},this.removeElement=function(a){var b=c.treeModel.findByParam("id",a.id);b&&b.remove();var d=c.itemsModel.findByParam("id",a.id);d&&d.remove()},this.fetchSelectedItems=function(a){var b,d;if(a===p.name)return c.itemsModel.getSelected();if(a===n.name)return c.treeModel.getSelected();if(!a)return b=c.treeModel.getSelected(),d=c.itemsModel.getSelected(),d.length>0?d:b;throw new Error("Unknown item type.")},this.fetchSelectedObjects=function(b){var d=[];return a.each(c.fetchSelectedItems(b.constructor.name),function(a,b){d.push(b.rdo)}),d};var f=function(){this.beforeLoad=function(a){},this.afterLoad=function(a,b){}},i=function(){var a=this,b=null;this.rdo=ko.observable({}),this.cdo=ko.observable({}),this.viewer={type:ko.observable("default"),isEditable:ko.observable(!1),url:ko.observable(null),pureUrl:ko.observable(null),options:ko.observable({}),content:ko.observable(null),codeMirror:ko.observable(null)},this.renderer=new J,this.editor=new K,this.rdo.subscribe(function(b){a.cdo({isFolder:"folder"===b.type,sizeFormatted:U(b.attributes.size),createdFormatted:V(b.attributes.created),modifiedFormatted:V(b.attributes.modified),extension:"file"===b.type?fa(b.id):null,dimensions:b.attributes.width?b.attributes.width+"x"+b.attributes.height:null})}),this.editor.content.subscribe(function(b){a.editor.isInteractive()&&a.renderer.render(b)}),this.afterRender=function(){a.renderer.render(a.viewer.content());var c=t.find(".btn-copy-url")[0];b=new Clipboard(c),b.on("success",function(a){j.success(P("copied"))})},this.initiateEditor=function(b){var c=t.find(".fm-cm-editor-content")[0];a.editor.createInstance(a.cdo().extension,c,{readOnly:!1,styleActiveLine:!0})},this.bindToolbar=function(b){e(a.rdo(),b)&&Ma(b,{},a.rdo())},this.previewIconClass=ko.pureComputed(function(){var b=[],c=["ico"];return"default"!==a.viewer.type()&&a.viewer.url()||(b.push("grid-icon"),this.cdo().isFolder===!0?(b.push("ico_folder"),c.push("folder"),this.rdo().attributes.readable||c.push("lock")):(b.push("ico_file"),this.rdo().attributes.readable?c.push("ext",this.cdo().extension):c.push("file","lock")),b.push(c.join("_"))),b.join(" ")},this),this.closePreview=function(){c.previewFile(!1)},this.editFile=function(){var b=a.viewer.content();a.renderer.render(b),a.editor.render(b)},this.saveFile=function(){Ea(a.rdo())},this.closeEditor=function(){a.editor.enabled(!1),a.renderer.render(a.viewer.content())},this.buttonVisibility=function(b){switch(b){case"select":return e(a.rdo(),b)&&g();case"move":case"rename":case"delete":case"download":return e(a.rdo(),b)}}},m=function(){function b(a){if(null!==E){a||(a=d.rootNode);var b=d.findByFilter(function(a){return 0===E.indexOf(a.id)},a);b?(v.filetree.expandSpeed=10,d.loadDataNode(b,!1,!0)):(E=null,v.filetree.expandSpeed=200,d.setItemsFromNode(a))}}var d=this;this.selectedNode=ko.observable(null);var e=new n({attributes:{}});e.id=w,e.level=ko.observable(-1),this.rootNode=e,this.mapNodes=function(a,b){b||(b=d.rootNode),b.isRoot()||a.call(this,b);var c=b.children();if(!c||0===c.length)return null;for(var e=0,f=c.length;e<f;e++)a.call(this,c[e]),d.findByFilter(a,c[e])},this.findByParam=function(a,b,c){if(!c&&(c=d.rootNode,c[a]===b))return c;var e=c.children();if(!e||0===e.length)return null;for(var f=0,g=e.length;f<g;f++){if(e[f][a]===b)return e[f];var h=d.findByParam(a,b,e[f]);if(h)return h}return null},this.findByFilter=function(a,b){if(!b&&(b=d.rootNode,a(b)))return b;var c=b.children();if(!c||0===c.length)return null;for(var e=0,f=c.length;e<f;e++){if(a(c[e]))return c[e];var g=d.findByFilter(a,c[e]);if(g)return g}return null},this.getSelected=function(){var a=[];return d.selectedNode()&&a.push(d.selectedNode()),a},this.loadDataNode=function(a,b,e){var f=a.id,g=new r(f);g.setPreloader(d.getPreloader(a)).setDataHandler(function(b,c){d.addNodes(b,a,e)}),b&&g.setPreloader(c.itemsModel.getPreloader()).setDataHandler(function(a,b){c.itemsModel.addItems(a,b,e),c.searchModel.clearInput()}),g.load(function(){return Ga(f)})},this.getPreloader=function(a){var c=function(){};return c.prototype=Object.create(f),c.prototype.beforeLoad=function(b){a.isRoot()||a.isLoaded(!1)},c.prototype.afterLoad=function(c,e){a.isRoot()||(a.isLoaded(!0),d.expandNode(a)),b(a)},new c},this.createNode=function(a){var b=new n(a);return B.filterModel.filterItem(b),b},this.createNodes=function(b){var c=[];return a.each(b,function(a,b){c.push(d.createNode(b))}),c},this.appendNodes=function(b,c){a.isArray(c)||(c=[c]),b||(b=d.rootNode),v.filetree.foldersOnly&&(c=a.grep(c,function(a){return a.cdo.isFolder})),a.each(c,function(a,c){c.parentNode(b)});var e=b.children().concat(c);b.children(Q(e))},this.addNodes=function(b,c,e){if(a.isArray(b)||(b=[b]),c){var f=d.createNodes(b);e&&c.children([]),d.appendNodes(c,f)}},this.expandNode=function(a){return a.isExpanded()===!1&&a.isLoaded()===!0&&(a.isSliding(!0),!0)},this.collapseNode=function(a){return a.isExpanded()===!0&&(a.isSliding(!0),!0)},this.toggleNode=function(a){d.collapseNode(a)||d.expandNode(a)},this.arrangeNode=function(b){var c=b.children().length;a.each(b.children(),function(a,d){d.level(b.level()+1),d.isFirstNode(0===a),d.isLastNode(a===c-1)})},this.setItemsFromNode=function(b){var d=[];a.each(b.children(),function(a,b){d.push(b.rdo)}),c.itemsModel.addItems(d,b.id,!0)},this.actualizeNodeObject=function(b,c,e){var f=new RegExp("^"+c),g=b.rdo.id,h=g.replace(f,e);b.id=h,b.rdo.id=h,b.rdo.attributes.path=b.rdo.attributes.path.replace(new RegExp(g+"$"),h),b.children().length&&a.each(b.children(),function(a,b){d.actualizeNodeObject(b,c,e)})}},n=function(a){var b=this;this.id=a.id,this.rdo=a,this.cdo={isFolder:"folder"===a.type,extension:"file"===a.type?fa(a.id):null,dimensions:a.attributes.width?a.attributes.width+"x"+a.attributes.height:null,cssItemClass:"folder"===a.type?"directory":"file",hiddenByType:!1,hiddenBySearch:!1},this.visible=ko.observable(!0),this.nodeTitle=ko.observable(a.attributes.name),this.children=ko.observableArray([]),this.parentNode=ko.observable(null),this.isSliding=ko.observable(!1),this.isLoading=ko.observable(!1),this.isLoaded=ko.observable(!1),this.isExpanded=ko.observable(!1),this.selected=ko.observable(!1),this.dragHovered=ko.observable(!1),this.level=ko.observable(0),this.isFirstNode=ko.observable(!1),this.isLastNode=ko.observable(!1),this.nodeTitle.subscribe(function(a){b.rdo.attributes.name=a}),this.children.subscribe(function(a){c.treeModel.arrangeNode(b)}),this.isLoaded.subscribe(function(a){b.isLoading(!a)}),this.selected.subscribe(function(a){a?(null!==c.treeModel.selectedNode()&&c.treeModel.selectedNode().selected(!1),c.treeModel.selectedNode(b),c.itemsModel.unselectItems()):c.treeModel.selectedNode(null)}),this.switchNode=function(a){return!!a.cdo.isFolder&&(a.rdo.attributes.readable?void(a.isLoaded()?c.treeModel.toggleNode(a):b.openNode(a,!1)):(j.error(P("NOT_ALLOWED_SYSTEM")),!1))},this.mouseDown=function(a,b){a.selected(!0)},this.nodeClick=function(a,c){v.manager.dblClickOpen||b.openNode(a,!0)},this.nodeDblClick=function(a,c){v.manager.dblClickOpen&&b.openNode(a,!0)},this.openNode=function(a,b,d){"file"===a.rdo.type&&h(a.rdo),"folder"===a.rdo.type&&(!a.isLoaded()||a.isExpanded()&&v.filetree.reloadOnClick?c.treeModel.loadDataNode(a,b,!0):(c.treeModel.toggleNode(a),b&&c.treeModel.setItemsFromNode(a)))},this.remove=function(){b.parentNode().children.remove(b)},this.isRoot=function(){return b.level()===c.treeModel.rootNode.level()},this.title=ko.pureComputed(function(){return v.options.showTitleAttr?this.rdo.id:null},this),this.itemClass=ko.pureComputed(function(){var a=[];return this.selected()&&v.manager.selection.enabled&&a.push("ui-selected"),this.dragHovered()&&a.push(c.ddModel.hoveredCssClass),a.join(" ")},this),this.iconClass=ko.pureComputed(function(){var a,b=["ico"];return this.cdo.isFolder===!0?(a="ico_folder",this.isLoading()===!0?b.push("loading"):(b.push("folder"),this.rdo.attributes.readable?(this.isExpanded()||!this.isExpanded()&&this.isSliding())&&b.push("open"):b.push("lock"))):(a="ico_file",this.rdo.attributes.readable?b.push("ext",this.cdo.extension):b.push("file","lock")),a+" "+b.join("_")},this),this.switcherClass=ko.pureComputed(function(){var a=[];if(v.filetree.showLine?0===this.level()&&this.isFirstNode()&&this.isLastNode()?a.push("root"):0===this.level()&&this.isFirstNode()?a.push("roots"):this.isLastNode()?a.push("bottom"):a.push("center"):a.push("noline"),this.cdo.isFolder){var b=this.isExpanded()||!this.isExpanded()&&this.isSliding();a.push(b?"open":"close")}else a.push("docu");return a.join("_")},this),this.clusterClass=ko.pureComputed(function(){return v.filetree.showLine&&!this.isLastNode()?"line":""},this)},o=function(){var d=this;this.objects=ko.observableArray([]),this.parentItem=ko.observable(null),this.objectsSize=ko.observable(0),this.objectsNumber=ko.observable(0),this.selectedNumber=ko.observable(0),this.listSortField=ko.observable(z),this.listSortOrder=ko.observable(A),this.isSelecting=ko.observable(!1),this.continiousSelection=ko.observable(!1),this.descriptivePanel=new J,this.lazyLoad=null,this.isSelecting.subscribe(function(a){a||d.continiousSelection(!1)}),this.createSearchItem=function(a){var b=new p(a);return b.isSearch=!0,B.filterModel.filterItem(b),b},this.createSearchItems=function(b){var c=[];return a.each(b,function(a,b){c.push(d.createSearchItem(b))}),c},this.createItem=function(a){var b=new p(a);return b.isSearch=!1,B.filterModel.filterItem(b),b},this.createItems=function(b){var c=[];return a.each(b,function(a,b){c.push(d.createItem(b))}),c},this.appendItems=function(b){a.isArray(b)||(b=[b]);var c=d.objects().concat(b);d.objects(Q(c))},this.addItems=function(b,e,f){a.isArray(b)||(b=[b]);var g=d.createItems(b);f?(c.currentPath(e),c.breadcrumbsModel.splitCurrent(),d.setDescriptivePanel(b),d.setItemsList(g),d.addParentItem()):d.appendItems(g)},this.loadDataList=function(a){var b=new r(a);b.setPreloader(d.getPreloader()).setDataHandler(function(a,b){d.addItems(a,b,!0),c.searchModel.clearInput()}).load(function(){return Ga(a)})},this.setItemsList=function(a){d.parentItem(null),a=Q(a),d.objects(a)},this.addParentItem=function(){if(!$(c.currentPath())&&c.currentPath()!==w){var a=ia(c.currentPath()),e={id:a,rdo:{id:a,type:"parent",attributes:{readable:!0,writable:!0}},dragHovered:ko.observable(!1)};e.open=function(a,c){b(c)&&(location.hash=e.id)},e.itemClass=ko.pureComputed(function(){var a=[];return e.dragHovered()&&a.push(c.ddModel.hoveredCssClass),a.join(" ")}),d.parentItem(e)}},this.setDescriptivePanel=function(b){d.descriptivePanel.content(null),a.each(b,function(a,b){v.manager.renderer.position&&"string"==typeof v.manager.renderer.indexFile&&b.attributes.name.toLowerCase()===v.manager.renderer.indexFile.toLowerCase()&&(d.descriptivePanel.setRenderer(b),Fa(d.descriptivePanel.rdo()).then(function(a){d.descriptivePanel.render(a)}))})},this.findByParam=function(a,b){return ko.utils.arrayFirst(d.objects(),function(c){return c[a]===b})},this.findByFilter=function(a,b){var c=!b,e=[],f=d.objects();if(!f||0===f.length)return c?null:e;for(var g=0,h=f.length;g<h;g++)if(a(f[g])){if(c)return f[g];e.push(f[g])}return c?null:e},this.sortObjects=function(){var a=Q(d.objects());d.objects(a)},this.getSelected=function(){var a=d.findByFilter(function(a){return a.selected()},!0)||[];return d.selectedNumber(a.length),a},this.unselectItems=function(b){var c=v.manager.selection.enabled&&v.manager.selection.useCtrlKey&&b===!0;c||a.each(d.getSelected(),function(a,b){b.selected(!1)})},this.initiateLazyLoad=function(){v.viewer.image.lazyLoad!==!0||d.lazyLoad||(d.lazyLoad=new LazyLoad({container:q[0],callback_load:function(a){j.console("LOADED",a.getAttribute("data-original"))},callback_set:function(a){j.console("SET",a.getAttribute("data-original"))},callback_processed:function(a){j.console("PROCESSED",a+" images left")}}))},this.getPreloader=function(){var a=function(){};return a.prototype=Object.create(f),a.prototype.beforeLoad=function(a){c.loadingView(!0)},a.prototype.afterLoad=function(a,b){c.loadingView(!1),d.lazyLoad&&d.lazyLoad.update()},new a},this.objects.subscribe(function(b){var c=0,e=0;a.each(b,function(a,b){c++,"file"===b.rdo.type&&(e+=Number(b.rdo.attributes.size))}),d.objectsNumber(c),d.objectsSize(U(e)),d.lazyLoad&&setTimeout(function(){d.lazyLoad.update()},50)})},p=function(a){var d=v.viewer.image.thumbMaxWidth;a.attributes.width&&a.attributes.width<d&&(d=a.attributes.width),this.id=a.id,this.rdo=a,this.cdo={isFolder:"folder"===a.type,sizeFormatted:U(a.attributes.size),createdFormatted:V(a.attributes.created),modifiedFormatted:V(a.attributes.modified),extension:"file"===a.type?fa(a.id):null,dimensions:a.attributes.width?a.attributes.width+"x"+a.attributes.height:null,cssItemClass:"folder"===a.type?"directory":"file",imageUrl:ra(a,!0,!0),previewWidth:d,hiddenByType:!1,hiddenBySearch:!1,displayName:"/"!==a.attributes.name.substr(a.attributes.name.length-1)?a.attributes.name:a.attributes.name.slice(0,a.attributes.name.length-1)},this.visible=ko.observable(!0),this.selected=ko.observable(!1),this.dragHovered=ko.observable(!1),this.lazyPreview=v.viewer.image.lazyLoad&&this.cdo.imageUrl,this.selected.subscribe(function(a){a&&null!==c.treeModel.selectedNode()&&c.treeModel.selectedNode().selected(!1)}),this.title=ko.pureComputed(function(){return v.options.showTitleAttr?this.rdo.id:null},this),this.itemClass=ko.pureComputed(function(){var a=[];return this.selected()&&v.manager.selection.enabled&&a.push("ui-selected"),this.dragHovered()&&a.push(c.ddModel.hoveredCssClass),this.cdo.cssItemClass+" "+a.join(" ")},this),this.listIconClass=ko.pureComputed(function(){var a,b=["ico"];return this.cdo.isFolder===!0?(a="ico_folder",b.push("folder"),this.rdo.attributes.readable||b.push("lock")):(a="ico_file",this.rdo.attributes.readable?b.push("ext",this.cdo.extension):b.push("file","lock")),a+" "+b.join("_")},this),this.gridIconClass=ko.pureComputed(function(){var a=[],b=["ico"];return this.cdo.imageUrl||(a.push("grid-icon"),this.cdo.isFolder===!0?(a.push("ico_folder"),b.push("folder"),this.rdo.attributes.readable||b.push("lock")):(a.push("ico_file"),this.rdo.attributes.readable?b.push("ext",this.cdo.extension):b.push("file","lock")),a.push(b.join("_"))),a.join(" ")},this),this.mouseDown=function(a,b){a.selected()||c.itemsModel.unselectItems(b.ctrlKey),c.selectionModel.unselect=a.selected(),a.selected(!0)},this.open=function(a,d){c.selectionModel.unselect&&(d.ctrlKey&&a.selected(!1),!d.ctrlKey&&v.manager.dblClickOpen&&(c.itemsModel.unselectItems(d.ctrlKey),a.selected(!0))),b(d)&&(v.options.quickSelect&&"file"===a.rdo.type&&e(a.rdo,"select")?wa(a.rdo):h(a.rdo))},this.remove=function(){c.itemsModel.objects.remove(this)}},r=function(b){var c=this,d=[],e=[];this.setPreloader=function(a){return e.push(a),c},this.setDataHandler=function(a){return d.push(a),c},this.load=function(c){e.forEach(function(a,c,d){a.beforeLoad(b)}),c().then(function(c){c.data&&(a.each(d,function(a,d){d(c.data,b)}),a.each(e,function(a,d){d.afterLoad(b,c)}))})}},s=function(){var a=function(a){var b=this;this.column=ko.observable(a),this.order=ko.observable(c.itemsModel.listSortOrder()),this.sortClass=ko.pureComputed(function(){var a;return c.itemsModel.listSortField()===b.column()&&(a="sorted sorted-"+this.order()),a},this),this.sort=function(){var a="asc"===b.order(),d=c.itemsModel.listSortField()===b.column();b.order(d?a?"desc":"asc":c.itemsModel.listSortOrder()),c.itemsModel.listSortField(b.column()),c.itemsModel.listSortOrder(b.order()),c.itemsModel.sortObjects()}};this.thName=new a("name"),this.thType=new a("type"),this.thSize=new a("size"),this.thDimensions=new a("dimensions"),this.thModified=new a("modified")},u=function(){this.closeButton=ko.observable(!1),this.langSwitcher=a.isArray(v.language.available)&&v.language.available.length>0,this.closeButtonOnClick=function(){j.console("CLOSE button is clicked")},this.navHome=function(){c.previewFile(!1),c.itemsModel.loadDataList(w)},this.navLevelUp=function(){var a=c.previewFile()?ha(c.previewModel.rdo().id):ia(c.currentPath());c.previewFile()&&c.previewFile(!1),a!==c.currentPath()&&c.itemsModel.loadDataList(a)},this.navRefresh=function(){c.previewFile()?(c.previewFile(!1),c.previewFile(!0)):c.itemsModel.loadDataList(c.currentPath())},this.displayGrid=function(){c.viewMode("grid"),c.previewFile(!1),c.itemsModel.lazyLoad&&c.itemsModel.lazyLoad.update()},this.displayList=function(){c.viewMode("list"),c.previewFile(!1)},this.switchLang=function(b){var c=b.target.value,d=C.getLang();if(c&&c.toLowerCase()!==d.toLowerCase()){var e,f=window.location.toString(),g=new RegExp("(langCode=)"+d);e=g.test(f)?f.replace(g,"$1"+c):f+(a.isEmptyObject(F.param())?"?":"#")+"langCode="+c,window.location.href=e}},this.createFolder=function(){function a(a,b){var c=b.getInputValue();return c?void oa("GET",{mode:"addfolder",path:B.currentPath(),name:c}).done(function(a){a.data&&(B.addElements(a.data,B.currentPath()),b.closeDialog(),v.options.showConfirmation&&j.success(P("successful_added_folder")))}).fail(Y):void j.error(P("no_foldername"))}return d("createFolder")?void j.prompt({message:P("prompt_foldername"),value:P("default_foldername"),okBtn:{label:P("create_folder"),autoClose:!1,click:a},cancelBtn:{label:P("cancel")}}):(j.error(P("NOT_ALLOWED")),!1)}},x=function(){this.files=ko.observable(null),this.folders=ko.observable(null),this.size=ko.observable(null),this.enabled=ko.observable(!1),this.doSummarize=function(){Ja()}},y=function(){var b=this;this.name=ko.observable(null),this.setName=function(c){c&&v.filter&&a.isArray(v.filter[c])&&b.name(c)},this.getExtensions=function(){return b.name()?v.filter[b.name()]:null},this.filterItem=function(c){var d=b.getExtensions(),e=!c.cdo.hiddenBySearch;if(c.cdo.hiddenByType=!1,"file"===c.rdo.type&&a.isArray(d)){var f=fa(c.id),g=d.indexOf(f)!==-1;e=e&&g,c.cdo.hiddenByType=!g}c.visible(e)},this.filter=function(d){b.setName(d),a.each(c.itemsModel.objects(),function(a,c){b.filterItem(c)}),c.treeModel.mapNodes(function(a){b.filterItem(a)}),c.itemsModel.lazyLoad&&c.itemsModel.lazyLoad.update()},this.reset=function(){b.name(null),b.filter(null)}},G=function(){function b(){h?D.push("search",function(){d()},v.search.typingDelay):d()}function d(){var b=f.value(),d=v.search.caseSensitive?b:b.toLowerCase();if(""===b)return void(b!==g?e():j.warning(P("search_string_empty")));if(v.search.recursive){var h=c.currentPath(),i=new r(h);i.setPreloader(c.itemsModel.getPreloader()).setDataHandler(function(b,e){var g=[];v.search.caseSensitive?a.each(b,function(a,b){0===b.attributes.name.indexOf(d)&&g.push(b)}):g=b;var h=c.itemsModel.createSearchItems(g);c.itemsModel.setItemsList(h),f.isRendered(!0)}).load(function(){return Ha(h,b)})}else a.each(c.itemsModel.objects(),function(a,b){var c=b.rdo.attributes.name;v.search.caseSensitive||(c=c.toLowerCase());var e=0===c.indexOf(d),f=!b.cdo.hiddenByType;f=f&&e,b.cdo.hiddenBySearch=!e,b.visible(f)}),f.isRendered(!0)}function e(){f.clearInput(),v.search.recursive?c.itemsModel.loadDataList(c.currentPath()):a.each(c.itemsModel.objects(),function(a,b){b.cdo.hiddenBySearch=!1,b.visible(!b.cdo.hiddenByType)})}var f=this,g="",h=!!v.search.typingDelay;this.value=ko.observable(""),this.isRendered=ko.observable(!1),this.value.subscribe(function(a){g=a},null,"beforeChange"),this.inputKeyUp=function(a,c){var d=c.which||c.keyCode,e=[16,17,18,27,37,38,39,40];if(h){if(e.indexOf(d)>-1)return;f.value(c.target.value)}(h||13===d)&&b()},this.seekItems=function(a,c){b()},this.reset=function(a,b){e()},this.clearInput=function(){g="",f.value(""),f.isRendered(!1),D.removeTimer("search")}},H=function(){function a(){e=[],b=null,f.itemsNum(0)}var b=null,e=[],f=this,g=d("copy")&&d("move");this.itemsNum=ko.observable(0),this.enabled=ko.observable(c.config().clipboard.enabled&&g),this.copy=function(){f.hasCapability("copy")&&(b="copy",e=c.fetchSelectedItems(),f.itemsNum(e.length))},this.cut=function(){f.hasCapability("cut")&&(b="cut",e=c.fetchSelectedItems(),f.itemsNum(e.length))},this.paste=function(){var d=c.currentPath();if(f.hasCapability("paste")&&!f.isEmpty())return null===b||0===e.length?void j.warning(P("clipboard_empty")):void ua(e,function(a,c){return"cut"===b?Aa(c,d):"copy"===b?za(c,d):void 0},a)},this.clear=function(){f.hasCapability("clear")&&!f.isEmpty()&&(a(),j.success(P("clipboard_cleared")))},this.isEmpty=function(){return 0===e.length},this.hasCapability=function(a){if(!f.enabled)return!1;switch(a){case"copy":return d("copy");case"cut":return d("move");default:return!0}}},I=function(){var a=this;this.items=ko.observableArray([]),this.clean=function(){a.items([]),a.add(w,"Baza wiedzy")},this.add=function(c,d){a.items.push(new b(c,d))},this.splitPath=function(b){var c=w,d=b.replace(new RegExp("^"+w),"").split("/");
for(a.clean();d.length>0;){var e=d.shift();e&&(c+=e+"/",a.add(c,e))}},this.splitCurrent=function(){a.splitPath(c.currentPath())},this.getLabel=ko.pureComputed(function(){var a=P(c.searchModel.isRendered()?"search_results":"current_folder");return a+": "},this);var b=function(a,b){var d=this;this.path=a,this.label=b,this.isRoot=a===w,this.active=a===c.currentPath(),this.itemClass=function(){var a=["nav-item"];return d.isRoot&&a.push("root"),d.active&&a.push("active"),a.join(" ")},this["goto"]=function(a,b){a.active||(location.hash=a.path)}}},J=function(){function b(a){return ma(a)?new f:la(a)?new e:void 0}var c,d=this;this.rdo=ko.observable({}),this.content=ko.observable(null),this.renderer=ko.observable(null),this.render=function(a){d.renderer()&&d.renderer().processContent(a)},this.setRenderer=function(a){d.rdo(a),d.renderer(b(a.attributes.name))},this.setContainer=function(b){a.each(b,function(){if(a(this).hasClass("fm-renderer-container"))return c=a(this),!1}),d.renderer().processDomElements(c)};var e=function(){this.name="codeMirror",this.interactive=!1;var a=new K;this.processContent=function(b){a.render(b),d.content(b)},this.processDomElements=function(b){if(!a.instance){var c=b.find(".fm-cm-renderer-content")[0],e=fa(d.rdo().id);a.createInstance(e,c,{readOnly:"nocursor",styleActiveLine:!1,lineNumbers:!1})}}},f=function(){function b(){c.find("a").each(function(){var b=a(this).attr("href"),c=B.previewModel.editor;if(c.enabled()&&c.isInteractive())a(this).off("click"),a(this).on("click",function(){return!1});else{if(b.search("://")!==-1||ca(b,"mailto:"))return;ma(b)&&a(this).on("click",function(a){return Ia(b).then(function(a){a.data&&h(a.data)}),!1})}})}this.name="markdown",this.interactive=!0;var e=window.markdownit({html:!0,linkify:!0,typographer:!0,highlight:function(a,b){if(b&&hljs.getLanguage(b))try{return'<pre class="highlight"><code>'+hljs.highlight(b,a,!0).value+"</code></pre>"}catch(c){}return'<pre class="highlight"><code>'+e.utils.escapeHtml(a)+"</code></pre>"},replaceLink:function(a,b){if(a.search("://")!==-1||ca(a,"mailto:"))return a;var c=ca(a,"/")?w:ha(d.rdo().id),e=c+aa(a,"/");if(ma(e))return e;var f=na("GET",{mode:"readfile",path:e});return pa(f)}}).use(window.markdownitReplaceLink);this.processContent=function(a){var c=e.render(a);d.content(c),b()},this.processDomElements=function(a){}}},K=function(){function b(a){c.enabled(!0),c.instance.setValue(a),setTimeout(function(){c.instance.refresh()},0)}var c=this,d=null;this.instance=null,this.enabled=ko.observable(!1),this.content=ko.observable(null),this.mode=ko.observable(null),this.isInteractive=ko.observable(!1),this.mode.subscribe(function(a){a&&(c.instance.setOption("mode",a),d&&(b(d),d=null))}),this.render=function(a){c.mode()?b(a):d=a},this.createInstance=function(b,d,e){var f,g={readOnly:"nocursor",styleActiveLine:!1,viewportMargin:1/0,lineNumbers:v.editor.lineNumbers,lineWrapping:v.editor.lineWrapping,theme:v.editor.theme,matchBrackets:v.editor.matchBrackets,extraKeys:{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},Esc:function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",!1)}}};f=CodeMirror.fromTextArea(d,a.extend({},g,e)),f.on("changes",function(a,b){c.content(a.getValue())}),c.instance=f}},L=function(){function b(b){var c=a.grep(f.items,function(a,c){if("folder"===b.rdo.type||"parent"===b.rdo.type){if(ca(b.rdo.id,a.rdo.id))return!0;if(b.rdo.id===ja(a.rdo.id))return!0}return a.id===b.id});return b.rdo.attributes.writable&&0===c.length}function d(a){null!==f.hoveredItem&&f.hoveredItem.dragHovered(!1),f.hoveredItem=a,a&&a.dragHovered(!0)}function e(a,b){b?a.addClass(g):a.removeClass(g)}var f=this,g="drop-restricted",h=a("#drag-helper-template");this.items=[],this.hoveredItem=null,this.dragHelper=null,this.isScrolling=!1,this.isScrolled=!1,this.hoveredCssClass="drop-hover",this.makeDraggable=function(b,d){"file"!==b.rdo.type&&"folder"!==b.rdo.type||a(d).draggable({distance:3,cursor:"pointer",cursorAt:{left:Math.floor(h.width()/2),bottom:15},scroll:!1,appendTo:l,containment:k,refreshPositions:!1,helper:function(){var a,d;return d=c.fetchSelectedItems(b.constructor.name).length>1?"ico_multiple":"folder"===b.rdo.type?"ico_folder":"ico_file ico_ext_"+fa(b.rdo.id),a=h.children(".drag-helper").clone(),a.find(".clip").addClass(d),f.dragHelper=a,a},start:function(a,d){f.items=c.fetchSelectedItems(b.constructor.name)},drag:function(b,c){a(this).draggable("option","refreshPositions",f.isScrolling||f.isScrolled),f.isScrolled=!1},stop:function(a,b){f.items=[],f.dragHelper=null}})},this.makeDroppable=function(c,g){"folder"!==c.rdo.type&&"parent"!==c.rdo.type||a(g).droppable({tolerance:"pointer",enableExtendedEvents:c instanceof p,accept:function(a){var b=ko.dataFor(a[0]),c=b?b.rdo.type:null;return"file"===c||"folder"===c},over:function(a,f){setTimeout(function(){d(null),e(f.helper,!1),b(c)||e(f.helper,!0),d(c)},0)},out:function(a,b){d(null),e(b.helper,!1)},drop:function(a,e){return d(null),!!b(c)&&void ua(f.items,function(a,b){return Aa(b.rdo,c.id)})}})}},M=function(){this.unselect=!1};this.treeModel=new m,this.itemsModel=new o,this.tableViewModel=new s,this.previewModel=new i,this.headerModel=new u,this.summaryModel=new x,this.filterModel=new y,this.searchModel=new G,this.clipboardModel=new H,this.breadcrumbsModel=new I,this.ddModel=new L,this.selectionModel=new M},P=function(a){return C.translate(a)},Q=function(a){function b(a){var b,c=z;switch("list"===B.viewMode()&&(c=B.itemsModel.listSortField()),c){case"type":b=a.cdo.extension||"";break;case"size":b=a.rdo.attributes.size;break;case"modified":b=a.rdo.attributes.modified;break;case"dimensions":b=a.cdo.dimensions||"";break;default:b=a.rdo.attributes.name}return"string"==typeof b&&(f.cases||(b=b.toLowerCase()),b=b.replace(/\s+/g," ")),b}function c(a,b){for(var c=d(a.toString()),e=d(b.toString()),f=0;c[f]&&e[f];f++)if(c[f]!==e[f]){var g=Number(c[f]),h=Number(e[f]);return g==c[f]&&h==e[f]?g-h:c[f]>e[f]?1:-1}return c.length-e.length}function d(a){for(var b,c,d=[],e=0,f=-1,g=0;b=(c=a.charAt(e++)).charCodeAt(0);){var h=46==b||b>=48&&b<=57;h!==g&&(d[++f]="",g=h),d[f]+=c}return d}var e="list"===B.viewMode()?B.itemsModel.listSortOrder():A,f={natural:!0,order:"asc"===e?1:-1,cases:!1};a.sort(function(a,d){var e,g=b(a),h=b(d);return e=g===h?0:void 0===g||void 0===h?0:f.natural&&(isNaN(g)||isNaN(h))?c(g,h):g<h?-1:g>h?1:0,e*=f.order});for(var g=[],h=a.length;h--;)"folder"===a[h].rdo.type&&(g.push(a[h]),a.splice(h,1));"top"!==v.options.folderPosition&&g.reverse();for(var i=0,j=g.length;i<j;i++)"top"===v.options.folderPosition?a.unshift(g[i]):a.push(g[i]);return a},R=function(b){return a.ajax({type:"HEAD",url:b})},S=function(b){var c=null;return b="undefined"==typeof b?"user":b,c="user"===b?F.param("config")?j.settings.baseUrl+"/config/"+F.param("config"):j.settings.configUrl?j.settings.configUrl:j.settings.baseUrl+"/config/filemanager.config.json":j.settings.baseUrl+"/config/filemanager.config.default.json",a.ajax({type:"GET",url:c,dataType:"json",cache:!1,error:function(a){j.error("Given config file ("+c+") does not exist!")}})},T=function(a){for(var b=0,c=a.length;b<c;b++)"string"==typeof a[b]&&(a[b]=j.settings.baseUrl+a[b]);toast.apply(this,a)},U=function(a,b){if(!a)return"";b=b||!1;for(var c=parseFloat(a),d=parseFloat(b?1e3:1024),e=0,f=[P("unit_bytes"),P("unit_kb"),P("unit_mb"),P("unit_gb")];;){if(c<d)return c=Math.round(100*c)/100,c+" "+f[e];c/=d,e+=1}},V=function(a){var b="string"==typeof a,c="number"==typeof a&&Math.floor(a)===a;if(!b&&!c)return"";c&&a<1e10&&(a=1e3*a);var d=new Date(a);return d instanceof Date&&!isNaN(d)?d.toLocaleDateString("pl-PL",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):a},W=function(b){var c;return C.getLang()&&P(b.title)?(c=P(b.title),a.each(b.meta.arguments,function(a,b){c=c.replace("%s",b)})):c=b.title,c},X=function(b){j.console("ERROR JSON",b),a.each(b,function(a,b){j.error(W(b)),b.meta.redirect&&(window.location.href=b.meta.redirect)})},Y=function(b){var c;if(a.isPlainObject(b)&&b.responseText){var d="application/json"===b.getResponseHeader("content-type");!b.responseJSON&&d&&(b.responseJSON=a.parseJSON(b.responseText)),a.isPlainObject(b.responseJSON)&&b.responseJSON.errors?X(b.responseJSON.errors):c=P("ERROR_SERVER")+" "+b.responseText}else c=b;c&&(j.console("ERROR TEXT",c),j.error(c))};!function(a){a.extend({inArrayInsensitive:function(b,c,d){if("string"!=typeof b)return a.inArray.apply(this,arguments);if(c){var e=c.length;for(d=d?d<0?Math.max(0,e+d):d:0,b=b.toLowerCase();d<e;d++)if(d in c&&c[d].toLowerCase()==b)return d}return-1}})}(jQuery);var Z=function(b){var c=fa(b);if(v.security.extensions.ignoreCase){if("ALLOW_LIST"===v.security.extensions.policy&&a.inArrayInsensitive(c,v.security.extensions.restrictions)!==-1)return!0;if("DISALLOW_LIST"===v.security.extensions.policy&&a.inArrayInsensitive(c,v.security.extensions.restrictions)===-1)return!0}else{if("ALLOW_LIST"===v.security.extensions.policy&&a.inArray(c,v.security.extensions.restrictions)!==-1)return!0;if("DISALLOW_LIST"===v.security.extensions.policy&&a.inArray(c,v.security.extensions.restrictions)===-1)return!0}return!1},$=function(a){return"/"!==a.charAt(a.length-1)},_=function(a,b){var c=new RegExp("^"+b+"+|"+b+"+$","g");return a.replace(c,"")},aa=function(a,b){var c=new RegExp("^"+b+"+","g");return a.replace(c,"")},ba=function(a,b){var c=new RegExp(b+"+$","g");return a.replace(c,"")},ca=function(a,b,c){return c=c||0,a.substr(c,b.length)===b},da=function(b){var c=[];return a.each(b.split("/"),function(a,b){c.push(encodeURIComponent(b))}),c.join("/")},ea=function(a){return a.replace(/\\/g,"/").replace(/\/+/g,"/")},fa=function(a){return 1===a.split(".").length?"":a.split(".").pop().toLowerCase()},ga=function(a){return a.lastIndexOf(".")!==-1?a.substring(0,a.lastIndexOf(".")):a},ha=function(a){return a.lastIndexOf("/")!==a.length-1?a.substr(0,a.lastIndexOf("/")+1):a},ia=function(a){return a.split("/").reverse().slice(2).reverse().join("/")+"/"},ja=function(a){return a.substring(0,a.slice(0,-1).lastIndexOf("/"))+"/"},ka=function(b){return a.inArray(fa(b),v.viewer.image.extensions)!==-1},la=function(b){return a.inArray(fa(b),v.viewer.codeMirrorRenderer.extensions)!==-1},ma=function(b){return a.inArray(fa(b),v.viewer.markdownRenderer.extensions)!==-1},na=function(b,c){var d,e=v.api.requestParams;if(b=b.toUpperCase(),a.isPlainObject(e)&&(d=e[b],a.isPlainObject(d)&&!a.isEmptyObject(d))){var f=a.extend({},e.MIXED||{},d);"POST"===b&&a.isArray(c)?a.each(f,function(a,b){c.push({name:a,value:b})}):c=a.extend({},c,f)}return c=j.settings.callbacks.beforeSetRequestParams(b,c)},oa=function(b,c,d){return d="undefined"==typeof d?"json":d,j.settings.callbacks.beforeSendRequest(b,c)===!1?a.Deferred().reject(P("NOT_ALLOWED")):a.ajax({type:b,cache:!1,url:pa(),dataType:d,data:na(b,c)})},pa=function(b){var c={time:(new Date).getTime()},d=a.extend({},b||{},c);return x+"?"+a.param(d)},qa=function(a,b){var c,d=a.attributes.path;if(v.viewer.absolutePath&&d)b&&(d=da(d)),c=sa(d,!1);else{var e=na("GET",{mode:"readfile",path:a.id});c=pa(e)}return c=j.settings.callbacks.beforeCreatePreviewUrl(a,c)},ra=function(a,b,c){var d;if(ka(a.id)&&a.attributes.readable&&(b&&v.viewer.image.showThumbs||!b&&v.viewer.image.enabled===!0)){if(v.viewer.absolutePath&&!b&&a.attributes.path)d=sa(da(a.attributes.path),c);else{var e={path:a.id};"svg"===fa(a.id)?e.mode="readfile":(e.mode="getimage",b&&(e.thumbnail="true")),e=na("GET",e),d=pa(e)}d=j.settings.callbacks.beforeCreateImageUrl(a,d)}return d},sa=function(a,b){var c="string"==typeof v.viewer.previewUrl?v.viewer.previewUrl:location.origin;return c=_(c,"/")+a,b&&(c+="?time="+(new Date).getTime()),c},ta=function(a){function b(a){return v.clipboard.encodeCopyUrl?da(a):a}if(v.viewer.absolutePath&&a.attributes.path){var c=b(a.attributes.path);return sa(c,!1)}var c=b(a.id),d="folder"===a.type?"readfolder":"readfile";return x+"?path="+c+"&mode="+d},ua=function(b,c,d){var e,f=function(){this.total=0,this.succeed=0,this.failure=0,this.processed=0,this.getProgress=function(){return Math.round(this.processed/this.total*100)},this.getProgressSucceed=function(){return Math.round(this.succeed/this.total*100)},this.getProgressFailure=function(){return Math.round(this.failure/this.total*100)},this.getMessage=function(){return P("successful_processed").replace("%s",this.succeed).replace("%s",this.total)},this.succeeded=function(){this.succeed++,this.processed++},this.failed=function(){this.failure++,this.processed++},this.isProcessed=function(){return this.processed===this.total}},g=new f,h=a.Deferred().resolve();g.total=b.length,g.total>1&&(e=j.write(g.getMessage(),{delay:0,logMessageTemplate:function(a){var b=(g.getProgress(),g.isProcessed()?"striped":"striped animated");return"<div>"+a+'</div><div class="progress"><div class="progress-counter">'+g.getProgress()+'%</div><div class="progress-bar '+b+'"><div class="progress-segment progress-succeed" style="width: '+g.getProgressSucceed()+'%"></div><div class="progress-segment progress-failure" style="width: '+g.getProgressFailure()+'%"></div></div></div>'}}),e.stick(!0)),a.each(b,function(a,b){h=h.then(function(){return c(a,b)}).then(function(a){a&&a.data?g.succeeded():g.failed(),e&&e.setMessage(g.getMessage())})}),h.then(function(){e&&g.isProcessed()&&(e.stick(!1),setTimeout(function(){e.remove()},6e3))}),h.then(function(){"function"==typeof d&&d()})},va=function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();a.removeAllRanges()}},wa=function(a){var b=null,c=qa(a,!0);if(c=j.settings.callbacks.beforeSelectItem(a,c),window.tinyMCEPopup){var d=tinyMCEPopup.getWindowArg("window");return d.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=c,"undefined"!=typeof d.ImageDialog&&(d.ImageDialog.getImageData&&d.ImageDialog.getImageData(),d.ImageDialog.showPreviewImage&&d.ImageDialog.showPreviewImage(c)),void tinyMCEPopup.close()}if(F.param("field_name")&&(parent.document.getElementById(F.param("field_name")).value=c,"undefined"!=typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!=typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close()),F.param("ImperaviElementId"))if(window.opener);else{var e=F.param("ImperaviElementId"),f=parent.$("#"+e).redactor("core.getObject");f&&(f.modal.close(),f.buffer.set(),ka(a.attributes.name)?f.insert.html('<img src="'+c+'">'):f.insert.html('<a href="'+c+'">'+a.attributes.name+"</a>"))}if(F.param("CKEditor")&&(window.opener?window.opener.CKEDITOR.tools.callFunction(F.param("CKEditorFuncNum"),c):(parent.CKEDITOR.tools.callFunction(F.param("CKEditorFuncNum"),c),parent.CKEDITOR.tools.callFunction(F.param("CKEditorCleanUpFuncNum")))),window.opener&&"function"==typeof window.opener.SetUrl)if(a.attributes.width){var g=c,h=a.attributes.width,i=a.attributes.height;window.opener.SetUrl(g,h,i)}else window.opener.SetUrl(c);window.opener&&(b=window.opener),window.parent&&window.self!==window.parent&&(b=window.parent),b&&b.postMessage({source:"richfilemanager",resourceObject:a,preview_url:c},"*"),j.settings.callbacks.afterSelectItem(a,c,b)},xa=function(a){var b=function(b,c){var d=a.id,e=c.getInputValue();if(!e)return void j.error(P("new_filename"));if(!v.options.allowChangeExtensions){var f=fa(a.attributes.name);f.length>0&&(e=e+"."+f)}if($(d)&&!Z(e)){var g="<p>"+P("INVALID_FILE_TYPE")+"</p>";return"ALLOW_LIST"===v.security.extensions.policy&&(g+="<p>"+P("ALLOWED_FILE_TYPE").replace("%s",v.security.extensions.restrictions.join(", "))+".</p>"),"DISALLOW_LIST"===v.security.extensions.policy&&(g+="<p>"+P("DISALLOWED_FILE_TYPE").replace("%s",v.security.extensions.restrictions.join(", "))+".</p>"),void j.error(g)}oa("GET",{mode:"rename",old:d,"new":e}).done(function(a){if(a.data){var b=a.data,e=B.treeModel.findByParam("id",d);if(e&&("folder"===e.rdo.type&&(e.nodeTitle(b.attributes.name),B.treeModel.actualizeNodeObject(e,d,b.id)),"file"===e.rdo.type)){var f=e.parentNode(),g=B.treeModel.createNode(b);e.remove(),f&&B.treeModel.appendNodes(f,g)}var h=B.itemsModel.parentItem();if(h&&h.id===d)B.itemsModel.parentItem().id=b.id;else{var i=B.itemsModel.findByParam("id",d);if(i){i.remove();var k=B.itemsModel.createItem(b);B.itemsModel.appendItems(k)}}B.currentPath()===d&&B.itemsModel.loadDataList(b.id),B.previewFile()&&B.previewModel.rdo().id===d&&B.previewModel.applyObject(b),c.closeDialog(),v.options.showConfirmation&&j.success(P("successful_rename"))}}).fail(Y)};j.prompt({message:P("new_filename"),value:v.options.allowChangeExtensions?a.attributes.name:ga(a.attributes.name),okBtn:{label:P("action_rename"),autoClose:!1,click:b},cancelBtn:{label:P("cancel")}})},ya=function(a,b){var c=function(a,c){var d=c.getInputValue();return d?(d=ba(d,"/")+"/",void b(d)):void j.error(P("prompt_foldername"))},d=a.length,e=d>1?P("prompt_move_multiple").replace("%s",d):P("prompt_move");j.prompt({message:e,value:B.currentPath(),okBtn:{label:P("action_move"),autoClose:!1,click:c},cancelBtn:{label:P("cancel")},template:{dialogInput:'<input data-alertify-input type="text" value="" /><div class="prompt-info">'+P("help_move")+"</div>"}})},za=function(a,b){return oa("GET",{mode:"copy",source:a.id,target:b}).done(function(a){if(a.data){var c=a.data;B.addElements(c,b),alertify.clearDialogs(),v.options.showConfirmation&&j.success(P("successful_copied"))}}).fail(Y)},Aa=function(a,b){return oa("GET",{mode:"move",old:a.id,"new":b}).done(function(c){if(c.data){var d=c.data;B.removeElement(a),B.addElements(d,b),B.currentPath()===a.id&&B.itemsModel.loadDataList(d.id),B.previewFile()&&B.previewModel.rdo().id===a.id&&B.previewFile(!1),alertify.clearDialogs(),v.options.showConfirmation&&j.success(P("successful_moved"))}}).fail(Y)},Ba=function(a,b){var c=a.length,d=c>1?P("confirm_delete_multiple").replace("%s",c):P("confirm_delete");j.confirm({message:d,okBtn:{label:P("yes"),click:function(a,c){b()}},cancelBtn:{label:P("no")}})},Ca=function(a){return oa("GET",{mode:"delete",path:a}).done(function(a){if(a.data){var b=a.data;if(B.removeElement(b),"folder"===b.type&&ca(B.currentPath(),b.id)){var c=ia(b.id);B.itemsModel.loadDataList(c)}B.previewFile()&&B.previewModel.rdo().id===b.id&&B.previewFile(!1),v.options.showConfirmation&&j.success(P("successful_delete"))}}).fail(Y)},Da=function(a){var b={mode:"download",path:a.id};window.open(pa(na("GET",b)))},Ea=function(b){var c=a("#fm-js-editor-form").serializeArray();oa("POST",c).done(function(a){if(a.data){var b=a.data,c=B.previewModel,d=c.editor.content();c.rdo(b),c.viewer.content(d),c.closeEditor();var e=B.itemsModel.createItem(b),f=B.itemsModel.findByParam("id",b.id);B.itemsModel.objects.replace(f,e),j.success(P("successful_edit"))}}).fail(Y)},Fa=function(a){return oa("GET",{mode:"readfile",path:a.id},"text").fail(Y)},Ga=function(a){return oa("GET",{mode:"readfolder",path:a}).fail(Y)},Ha=function(a,b){return oa("GET",{mode:"seekfolder",path:a,string:b}).fail(Y)},Ia=function(a){return oa("GET",{mode:"getinfo",path:a}).fail(Y)},Ja=function(){return oa("GET",{mode:"summarize"}).done(function(b){if(b.data){var c=b.data.attributes,d=U(c.size,!0);if(c.sizeLimit>0){var e=U(c.sizeLimit,!0),f=100*c.size/c.sizeLimit,g=Math.round(100*f)/100;d+=" ("+g+"%) "+P("of")+" "+e}B.summaryModel.files(c.files),B.summaryModel.folders(c.folders),B.summaryModel.size(d),B.summaryModel.enabled(!0);var h=a("#summary-popup").clone().show();B.summaryModel.enabled(!1),j.alert(h[0].outerHTML)}}).fail(Y)},Ka=function(a){var b=function(b,c){var d=c.getInputValue();return d?(d=ba(d,"/")+"/",void La(a,d)):void j.error(P("prompt_foldername"))};j.prompt({message:P("prompt_extract"),value:B.currentPath(),okBtn:{label:P("action_extract"),autoClose:!1,click:b},cancelBtn:{label:P("cancel")}})},La=function(a,b){oa("POST",{mode:"extract",source:a.id,target:b}).done(function(a){a.data&&(B.addElements(a.data,b),alertify.clearDialogs(),v.options.showConfirmation&&j.success(P("successful_extracted")))}).fail(Y)},Ma=function(b,c,d,e){var f=e?e:[d];switch(b){case"select":wa(d);break;case"download":a.each(f,function(a,b){Da(b)});break;case"rename":xa(d);break;case"move":ya(f,function(a){ua(f,function(b,c){return Aa(c,a)})});break;case"delete":Ba(f,function(){ua(f,function(a,b){return Ca(b.id)})});break;case"extract":Ka(d);break;case"copy":B.clipboardModel.copy(f);break;case"cut":B.clipboardModel.cut(f);break;case"copyUrl":var g=new Clipboard(c.$selected[0],{text:function(a){return ta(d)}});g.on("success",function(a){j.success(P("copied")),g.destroy()})}};G(),a(window).resize(j.setDimensions)}}(jQuery),$.fn.richFilemanager=function(a){return this.each(function(){if(void 0===$(this).data("richFilemanager")){var b=new $.richFilemanagerPlugin(this,a);$(this).data("richFilemanager",b)}})},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));